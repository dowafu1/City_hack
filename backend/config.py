import os
import json
from typing import Tuple, Dict
from pathlib import Path

from dotenv import load_dotenv


class Config:
  @staticmethod
  def load_env() -> None:
    dotenv_path = Path(__file__).parent / ".env"
    if not dotenv_path.exists():
      print(f"‚ùå –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: {dotenv_path}")
      exit(1)
    load_dotenv(dotenv_path)
    print(f"‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑: {dotenv_path}")

  @staticmethod
  def get_required_env_vars() -> Tuple[str, str, str, set]:
    bot_token = os.getenv("BOT_TOKEN")
    sber_token = os.getenv("SBER_TOKEN")
    mistral_token = os.getenv("MISTRAL_TOKEN")
    admin_ids = {int(x) for x in os.getenv("ADMIN_IDS", "123456789").split(',') if x.strip()}
    if not bot_token:
      raise ValueError("‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å BOT_TOKEN –≤ .env")
    return bot_token, sber_token, mistral_token, admin_ids


class PresetManager:
  DEFAULT_PRESETS = {
    "gigachat_prompt": "–¢—ã —ç–º–ø–∞—Ç–∏—á–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥-–ø–æ–º–æ—â–Ω–∏–∫. –¢—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –∏ –≤–∑—Ä–æ—Å–ª—ã—Ö –≤ —Ç—Ä—É–¥–Ω—ã—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –ø–æ –¥–µ–ª—É, —Å —Å–æ—á—É–≤—Å—Ç–≤–∏–µ–º. –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏. –ù–µ –¥–∞–≤–∞–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤, –Ω–∞–ø—Ä–∞–≤–ª—è–π –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.",
    "mistral_summarize_prompt": "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä-–ø—Å–∏—Ö–æ–ª–æ–≥. –£–ª—É—á—à–∏ –æ—Ç–≤–µ—Ç, —Å–¥–µ–ª–∞–π –µ–≥–æ –±–æ–ª–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –ø–æ–ª–µ–∑–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º. –£–±–µ—Ä–∏ –ª–∏—à–Ω–µ–µ, –¥–æ–±–∞–≤—å —è—Å–Ω–æ—Å—Ç–∏.",
    "tip_prompt": "–°–æ–∑–¥–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞ –≤ —Ç—Ä—É–¥–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. –°–æ–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º."
  }

  @classmethod
  def load_presets(cls) -> Dict[str, str]:
    try:
      with open("preset_prompts.json", 'r', encoding='utf-8') as f:
        return json.load(f)
    except FileNotFoundError:
      print("‚ùå –§–∞–π–ª preset_prompts.json –Ω–µ –Ω–∞–π–¥–µ–Ω")
      return cls.DEFAULT_PRESETS
    except Exception as e:
      print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤: {e}")
      return cls.DEFAULT_PRESETS


WELCOME_TEXT = (
  "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî *–¶–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫* –¶–µ–Ω—Ç—Ä–∞ –º–æ–ª–æ–¥–µ–∂–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –¢–æ–º—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏.\n\n"
  "üîπ –ï—Å–ª–∏ —Ç—ã –≤ *–æ—Å—Ç—Ä–æ–π –∏–ª–∏ —É–≥—Ä–æ–∂–∞—é—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏* ‚Äî —Å—Ä–∞–∑—É –Ω–∞–∂–º–∏ **¬´üö® –¢—Ä–µ–≤–æ–∂–Ω–∞—è –∫–Ω–æ–ø–∫–∞¬ª**.\n"
  "–¢—ã –ø–æ–ª—É—á–∏—à—å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å–º–æ–∂–µ—à—å –∞–Ω–æ–Ω–∏–º–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å ‚Äî —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.\n\n"
  "üîπ –ï—Å–ª–∏ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ ‚Äî –≤—ã–±–µ—Ä–∏, –∫—Ç–æ —Ç—ã:\n"
  "‚Ä¢ *–Ø –ø–æ–¥—Ä–æ—Å—Ç–æ–∫* ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —Å–æ–≤–µ—Ç—ã, –ø–æ–Ω–∏–º–∞–Ω–∏–µ\n"
  "‚Ä¢ *–Ø –≤–∑—Ä–æ—Å–ª—ã–π* ‚Äî —Ä–µ—Å—É—Ä—Å—ã –∏ –ø–æ–º–æ—â—å\n\n"
  "–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ—Ç–∫—Ä–æ—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª—ã –ø–æ–º–æ—â–∏, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ —Å–≤—è–∑–∏ —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏.\n\n"
  "–í—ã–±–µ—Ä–∏, —á—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç —Ç–µ–±–µ —Å–µ–π—á–∞—Å:"
)

INFO_TEXT = (
  "üß† *–ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?*\n\n"
  "–í—ã–±–∏—Ä–∞–π, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ ‚Äî —è —Ä—è–¥–æ–º:\n\n"
  "üÜò *–¢—Ä–µ–≤–æ–∂–Ω–∞—è –∫–Ω–æ–ø–∫–∞*\n"
  "–ï—Å–ª–∏ —Ç—ã –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî –ø–æ–ª—É—á–∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.\n\n"
  "üß≠ *–ú–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å*\n"
  "–ü–æ—à–∞–≥–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞: —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ç—Ä–µ–≤–æ–∂–Ω–æ, —Å—Ç—Ä–∞—à–Ω–æ –∏–ª–∏ —Ç—è–∂–µ–ª–æ.\n\n"
  "ü§ñ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ò–ò)\n"
  "–ü–æ–ª—É—á–∏ —Å–æ–≤–µ—Ç, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É\n\n"
  "üìû *–ö—É–¥–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è?*\n"
  "–ì–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏, –ø—Å–∏—Ö–æ–ª–æ–≥–∏, —é—Ä–∏—Å—Ç—ã ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å–ª—É–∂–± –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\n"
  "‚ùì *–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å*\n"
  "–ê–Ω–æ–Ω–∏–º–Ω–æ –Ω–∞–ø–∏—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É ‚Äî —è –ø–µ—Ä–µ–¥–∞–º –∏ –ø–æ–º–æ–≥—É –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç.\n\n"
  "üìÖ *–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è*\n"
  "–ß–µ–º –∑–∞–Ω—è—Ç—å—Å—è: –∞—Ñ–∏—à–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–ª–æ–¥—ë–∂–∏ –æ—Ç –¶–ú–ü –∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.\n\n"
  "üí° *–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç*\n"
  "–¢—ë–ø–ª—ã–π —Å–æ–≤–µ—Ç –¥–Ω—è ‚Äî —á—Ç–æ–±—ã –±—ã–ª–æ —á—É—Ç—å –ª–µ–≥—á–µ.\n\n"
  "üîî *–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É*\n"
  "–ü–æ–ª—É—á–∞–π –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —Å–æ–≤–µ—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–∞–π—Å—è –Ω–∞ —Å–≤—è–∑–∏.\n\n"
  "üîÑ *–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å*\n"
  "–°–º–µ–Ω–∏ —Ä–æ–ª—å (–ø–æ–¥—Ä–æ—Å—Ç–æ–∫ / –≤–∑—Ä–æ—Å–ª—ã–π), —á—Ç–æ–±—ã —è –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–ª, –∫–∞–∫ –ø–æ–º–æ—á—å.\n\n"
  "–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å? –í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω–æ–µ –≤ –º–µ–Ω—é –Ω–∏–∂–µ:"
)
